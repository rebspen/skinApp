import type { NextPage } from "next";
import Head from "next/head";
import getProducts from "./api/products";
import type { NextApiRequest, NextApiResponse } from "next";
import { Product } from "@prisma/client";
import Link from "next/link";

interface Props {
  products: Product[];
}

const Home: NextPage<Props> = (props) => {
  return (
    <div>
      <Head>
        <title>Products</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="p-10 flex justify-center flex-col items-center">
        <h1 className="text-2xl mb-10">Products Page</h1>
        {props.products.map((product, idx) => {
          return (
            <div key={idx} className="border-solid border-2 border-indigo-600 p-5 mb-4">
              <Link href={`/product/${product.id}`}>
                {product.name}
              </Link>
            </div>
          );
        })}
      </main>
    </div>
  );
};

export async function getServerSideProps({
  req,
  res,
}: {
  req: NextApiRequest;
  res: NextApiResponse<Product[]>;
}) {
  const products = await getProducts(req, res);
  return {
    props: { products },
  };
}

export default Home;
